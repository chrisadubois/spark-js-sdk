/**
 * stores the last x filtered stream datas
 */
export default class StatsHistory {
  /**
   * instantiate our wrapped history array
   * @param {Number} max
   */
  constructor(max) {
    this.history = [];
    this.max = max;
  }

  /**
   * @returns {Array} the array of stats reports, read from [0] = most recent to [length - 1] = least recent
   */
  get() {
    return this.history;
  }

  /**
   * deletes the history array and resets it
   * @returns {undefined}
   */
  clear() {
    this.history = [];
  }

  /**
   * gets the stored stat
   * @param {Number} index the location
   * @returns {Object} the stat at location index
   */
  getAt(index) {
    return this.history[index];
  }

  /**
   * gets the most recently stored stat
   * @returns {Object} the most recently added stat to the history recorder
   */
  getMostRecent() {
    return this.history.length > 1 ? this.getAt(0) : null;
  }

  getComparable() {
    return {
      previous: this.getMostRecent(),
      current: this.history.length > 2 ? this.getAt(1) : null
    };
  }

  getSlice(exclusiveEnd) {
    return this.history.slice(0, exclusiveEnd);
  }

  /**
   * adds a history entry into the array at the head, removes from the tail
   * if too large, returns the old tail if removed
   * @param {WebRTCData} data filtered stats report to add to the history array
   * @returns {Object} the removed stats report at the end if that had to be removed
   * to make space for the new stats data report to be added to the front
   */
  add(data) {
    let removed = null;

    if (this.history.length >= this.max) {
      removed = this.history.pop();
    }
    this.history.unshift(data);

    return removed;
  }
}
